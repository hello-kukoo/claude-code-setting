## 🎯 重构目标
- 提升代码清晰度和可理解性
- 优化项目结构和模块组织
- 改善代码可维护性
- 统一编码风格和命名规范

## ⚠️ 重构原则
- **行为不变（强约束）**: 相同输入产生相同输出、相同副作用、相同错误类型/消息和相同日志级别/内容。
- **对外接口名称不变**: 公共类/函数签名、参数与默认值、环境变量键名与语义、保持不变。
- **数据契约不变**: 数据库结构与查询语义、持久化数据格式、序列化字段名与顺序保持不变。
- **并发与时序不变**: 不新增并发单元，不改变重试、超时、退避策略及顺序语义。
- **允许的更改（仅结构性）**: 文件/模块移动、类/函数拆分、内聚度提升、添加轻量适配层、补充类型注解/文档、极小范围格式化（不改行为）。
- **禁止的更改（全部拒绝）**: 性能微调、算法替换、默认值调整、日志文案/错误消息更改、排序/去重逻辑改变、随机性/种子变动、I/O 位置或格式变化。
- **完整迁移原则**: 抽取/迁移某个单元时，连同其直接依赖的私有工具函数、常量、数据结构一并迁移，避免跨模块耦合残留。
- **即时更新调用端**: 每次迁移完成后，立刻批量更新所有引用并进行最小验证，确保可直接以生产路径运行。

### 变更粒度与提交
- **单一职责变更**: 每次只做一类结构性修改（如“提取解析器”），避免混入无关改动。
- **小步可回退**: 让每次变更可独立通过最小验证并可快速回滚。

## 🔔 重要提醒
1. **文档同步（立即）**: 完成每个子任务后，立刻在本文件勾选 TODO、更新“进度跟踪”计数与“最后更新”日期。
2. **仅结构性重构**: 任何可能改变行为的修改一律禁止；若确需优化，应另起议题单独处理。
3. **引用溯源**: 对每段迁移代码标注来源映射，格式：`原: 路径:行 → 新: 路径`，尽量保持前后完全一致性，请每次做好对比。
4. **最小验证（每步）**:   
    - **全面搜索残留引用**：保证检索结果为 0   
    - 采样运行关键模式各一次（若可自动）：不报错，输出路径未变
5. **变更小步拆分**: 大任务先拆解为数个可独立验证的小任务，逐一提交，降低回归风险。
6. **风格保持**: 保留原始变量名、错误文案、日志格式与注释语气；新增内容尽量贴合现有风格。

#### 总结: AI重构的核心原则
1. **系统性思维优于局部思维** - 分析完整的功能单元，不是单个方法
2. **依赖分析优于代码拷贝** - 先理解调用关系，再进行重构  
3. **渐进验证优于批量操作** - 小步快跑，每步验证
4. **工具辅助优于人工分析** - 使用 grep/rg 等工具发现隐藏依赖
5. **行为保持优于代码美化** - 重构的首要目标是保持功能不变

